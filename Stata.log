-------------------------------------------------------------------------------
      name:  <unnamed>
       log:  K:\Stata.log
  log type:  text
 opened on:  27 Nov 2018, 00:25:42

. 
. * Import dataset: -----------------------------------------------------------
> ---
. 
. import delimited using pima.csv, clear
(10 vars, 768 obs)

. summarize

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          v1 |        768       384.5    221.8468          1        768
    pregnant |        768    3.845052    3.369578          0         17
     glucose |        768    120.8945    31.97262          0        199
   diastolic |        768    69.10547    19.35581          0        122
     triceps |        768    20.53646    15.95222          0         99
-------------+---------------------------------------------------------
     insulin |        768    79.79948     115.244          0        846
         bmi |        768    31.99258     7.88416          0       67.1
    diabetes |        768    .4718763    .3313286       .078       2.42
         age |        768    33.24089    11.76023         21         81
        test |        768    .3489583    .4769514          0          1

. 
. * Clean data: ---------------------------------------------------------------
> ---
. drop if glucose == 0 | diastolic == 0 | triceps ==0 | insulin == 0 | bmi == 0
(376 observations deleted)

. summarize 

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          v1 |        392    388.0893    216.0165          4        766
    pregnant |        392     3.30102    3.211424          0         17
     glucose |        392    122.6276    30.86078         56        198
   diastolic |        392    70.66327    12.49609         24        110
     triceps |        392    29.14541    10.51642          7         63
-------------+---------------------------------------------------------
     insulin |        392    156.0561    118.8417         14        846
         bmi |        392    33.08622    7.027659       18.2       67.1
    diabetes |        392    .5230459     .345488       .085       2.42
         age |        392     30.8648    10.20078         21         81
        test |        392    .3316327    .4714014          0          1

. 
. * Implement logistic model: -------------------------------------------------
> ---
. logit test pregnant glucose diastolic triceps insulin bmi diabetes age

Iteration 0:   log likelihood =  -249.0489  
Iteration 1:   log likelihood =  -174.9074  
Iteration 2:   log likelihood = -172.03027  
Iteration 3:   log likelihood = -172.01062  
Iteration 4:   log likelihood = -172.01062  

Logistic regression                             Number of obs     =        392
                                                LR chi2(8)        =     154.08
                                                Prob > chi2       =     0.0000
Log likelihood = -172.01062                     Pseudo R2         =     0.3093

------------------------------------------------------------------------------
        test |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    pregnant |   .0821594   .0554256     1.48   0.138    -.0264727    .1907915
     glucose |   .0382695   .0057677     6.64   0.000      .026965     .049574
   diastolic |  -.0014203   .0118334    -0.12   0.904    -.0246133    .0217727
     triceps |   .0112214   .0170837     0.66   0.511    -.0222621    .0447049
     insulin |  -.0008253   .0013064    -0.63   0.528    -.0033859    .0017353
         bmi |   .0705376   .0273422     2.58   0.010     .0169479    .1241272
    diabetes |   1.140909    .427434     2.67   0.008     .3031534    1.978664
         age |   .0339516   .0183817     1.85   0.065    -.0020759    .0699791
       _cons |  -10.04074   1.217675    -8.25   0.000    -12.42734   -7.654139
------------------------------------------------------------------------------

. 
. * Backward elimination using BIC: -------------------------------------------
> ---
. // Use stepwise to determine the order at which to drop the variables
. stepwise, pr(0.05): logit test pregnant glucose diastolic triceps insulin bmi
>  diabetes age
                      begin with full model
p = 0.9045 >= 0.0500  removing diastolic
p = 0.5319 >= 0.0500  removing insulin
p = 0.4969 >= 0.0500  removing triceps
p = 0.1271 >= 0.0500  removing pregnant

Logistic regression                             Number of obs     =        392
                                                LR chi2(4)        =     150.86
                                                Prob > chi2       =     0.0000
Log likelihood =  -173.6175                     Pseudo R2         =     0.3029

------------------------------------------------------------------------------
        test |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
    diabetes |   1.087129   .4194086     2.59   0.010     .2651029    1.909154
     glucose |    .036189   .0049819     7.26   0.000     .0264245    .0459534
         age |   .0530121   .0134395     3.94   0.000     .0266712     .079353
         bmi |   .0744485   .0202667     3.67   0.000     .0347265    .1141705
       _cons |  -10.09202   1.080252    -9.34   0.000    -12.20927   -7.974763
------------------------------------------------------------------------------

. // Drop order: diastolic, insulin, triceps, pregnant
. 
. // Check BIC for each step
. 
. // Full model: BIC = 397.7626
. quietly logit test pregnant glucose diastolic triceps insulin bmi diabetes ag
> e

. estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
           . |        392 -249.0489  -172.0106       9    362.0212   397.7626
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. // Model 1 (drop diastolic): BIC = 391.8057
. quietly logit test pregnant glucose triceps insulin bmi diabetes age

. estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
           . |        392 -249.0489  -172.0178       8    360.0356   391.8057
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. // Model 2 (drop insulin): BIC = 386.223
. quietly logit test pregnant glucose triceps bmi diabetes age

. estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
           . |        392 -249.0489  -172.2121       7    358.4242    386.223
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. // Model 3 (drop triceps): BIC = 380.7127
. quietly logit test pregnant glucose bmi diabetes age

. estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
           . |        392 -249.0489  -172.4426       6    356.8851   380.7127
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. // Model 4 (drop pregnant): BIC = 377.0913s
. logit test glucose bmi diabetes age

Iteration 0:   log likelihood =  -249.0489  
Iteration 1:   log likelihood =  -176.2449  
Iteration 2:   log likelihood = -173.63285  
Iteration 3:   log likelihood =  -173.6175  
Iteration 4:   log likelihood =  -173.6175  

Logistic regression                             Number of obs     =        392
                                                LR chi2(4)        =     150.86
                                                Prob > chi2       =     0.0000
Log likelihood =  -173.6175                     Pseudo R2         =     0.3029

------------------------------------------------------------------------------
        test |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     glucose |    .036189   .0049819     7.26   0.000     .0264245    .0459534
         bmi |   .0744485   .0202667     3.67   0.000     .0347265    .1141705
    diabetes |   1.087129   .4194086     2.59   0.010     .2651029    1.909154
         age |   .0530121   .0134395     3.94   0.000     .0266712     .079353
       _cons |  -10.09202   1.080252    -9.34   0.000    -12.20927   -7.974763
------------------------------------------------------------------------------

. estat ic

Akaike's information criterion and Bayesian information criterion

-----------------------------------------------------------------------------
       Model |        Obs  ll(null)  ll(model)      df         AIC        BIC
-------------+---------------------------------------------------------------
           . |        392 -249.0489  -173.6175       5     357.235   377.0913
-----------------------------------------------------------------------------
               Note: N=Obs used in calculating BIC; see [R] BIC note.

. 
. // Check p-values of remaining model
. logit test glucose bmi diabetes age

Iteration 0:   log likelihood =  -249.0489  
Iteration 1:   log likelihood =  -176.2449  
Iteration 2:   log likelihood = -173.63285  
Iteration 3:   log likelihood =  -173.6175  
Iteration 4:   log likelihood =  -173.6175  

Logistic regression                             Number of obs     =        392
                                                LR chi2(4)        =     150.86
                                                Prob > chi2       =     0.0000
Log likelihood =  -173.6175                     Pseudo R2         =     0.3029

------------------------------------------------------------------------------
        test |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     glucose |    .036189   .0049819     7.26   0.000     .0264245    .0459534
         bmi |   .0744485   .0202667     3.67   0.000     .0347265    .1141705
    diabetes |   1.087129   .4194086     2.59   0.010     .2651029    1.909154
         age |   .0530121   .0134395     3.94   0.000     .0266712     .079353
       _cons |  -10.09202   1.080252    -9.34   0.000    -12.20927   -7.974763
------------------------------------------------------------------------------

. // All variables are significant
. 
. * Model fitting: ------------------------------------------------------------
> ---
. predict p
(option pr assumed; Pr(test))

. 
. * Classification report: ----------------------------------------------------
> ---
. estat classification

Logistic model for test

              -------- True --------
Classified |         D            ~D  |      Total
-----------+--------------------------+-----------
     +     |        79            29  |        108
     -     |        51           233  |        284
-----------+--------------------------+-----------
   Total   |       130           262  |        392

Classified + if predicted Pr(D) >= .5
True D defined as test != 0
--------------------------------------------------
Sensitivity                     Pr( +| D)   60.77%
Specificity                     Pr( -|~D)   88.93%
Positive predictive value       Pr( D| +)   73.15%
Negative predictive value       Pr(~D| -)   82.04%
--------------------------------------------------
False + rate for true ~D        Pr( +|~D)   11.07%
False - rate for true D         Pr( -| D)   39.23%
False + rate for classified +   Pr(~D| +)   26.85%
False - rate for classified -   Pr( D| -)   17.96%
--------------------------------------------------
Correctly classified                        79.59%
--------------------------------------------------

. 
. * ROC Curve: ----------------------------------------------------------------
> ---
. lroc, title("Receiving Operator Characteristic Curve") xtitle("False Positive
>  Rate") ytitle("True Positive Rate")

Logistic model for test

number of observations =      392
area under ROC curve   =   0.8605

. 
. * Hosmer-Lemeshow Test: -----------------------------------------------------
> ---
. egen dec=cut(p), at(0(0.1)1)

. hl test p, q(dec) plot
 Group         N      Obs (%)        Exp (%)     Min %     Max %        HL
     1        96      3 (3.1)      5.2 (5.4)       0.9      10.0      0.96
     2        84     10 (11.9)    12.0 (14.3)     10.0      19.9      0.38
     3        48     14 (29.2)    11.7 (24.4)     20.1      29.8      0.59
     4        38     14 (36.8)    13.4 (35.3)     30.4      39.9      0.04
     5        18     10 (55.6)     8.0 (44.4)     40.2      49.6      0.92
     6        23     14 (60.9)    12.5 (54.2)     50.5      59.6      0.41
     7        20     13 (65.0)    13.1 (65.5)     60.7      70.0      0.00
     8        28     21 (75.0)    21.3 (75.9)     70.3      79.9      0.01
     9        21     17 (81.0)    17.8 (84.9)     81.1      89.8      0.26
    10        16     14 (87.5)    15.1 (94.1)     90.1      99.2      1.24
 Total       392    130 (33.2)    130.0 (33.2)     0.9      99.2      4.82

       number of observations =       392
             number of groups =        10
      Hosmer-Lemeshow chi2(10) =         4.82
                  Prob > chi2 =         0.9031

. 
. log close
      name:  <unnamed>
       log:  K:\Stata.log
  log type:  text
 closed on:  27 Nov 2018, 00:26:52
-------------------------------------------------------------------------------
